#################
# Deletes all snapshots for the given VM
#
#!/bin/bash
[ -n "${1}" ] || {
    echo "Usage: ${0} <ID | NAME>"
    exit 1
}

# Check for the VM
prlctl status "${1}" >/dev/null || exit $?

# Get the list of snapshots and delete them all - but delete them in reverse order for speed
for i in $(prlctl snapshot-list "${1}" | sed -En 's/^.*{([^}]*)}.*$/\1/p' | tail -r); do
    prlctl snapshot-delete "${1}" -i "${i}" || exit 1
done
